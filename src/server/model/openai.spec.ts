import { beforeAll, describe, expect, test } from 'vitest';
import { env } from '../utils/env.js';
import {
  getOpenAIClient,
  groupByTokenSize,
  ensureJSONOutput,
  calcMessagesToken,
} from './openai.js';
import OpenAI from 'openai';
import { mapValues } from 'lodash-es';
// @ts-ignore
import { ChatCompletionMessageParam } from 'openai/resources/chat/completions.mjs';

const functions = {
  getCurrentDate: {
    name: 'getCurrentDate',
    description: 'Get the current date and time',
    parameters: {
      type: 'object',
      properties: {
        format: {
          type: 'string',
          description: "Date format, such as 'YYYY-MM-DD' or 'ISO'",
        },
      },
      required: ['format'],
    },
  },
};

async function executeFunction(name: string, args: any) {
  if (name === 'getCurrentDate') {
    const { format } = args;
    const now = new Date();
    if (format === 'YYYY-MM-DD') {
      return { date: now.toISOString().split('T')[0] };
    } else if (format === 'ISO') {
      return { date: now.toISOString() };
    } else {
      throw new Error('Unsupported format');
    }
  }
  throw new Error('Function not implemented');
}

describe.runIf(env.openai.apiKey)('openai', () => {
  let openaiClient: OpenAI;

  beforeAll(() => {
    openaiClient = getOpenAIClient();
  });

  test('test openai tool choose', async () => {
    try {
      const chatCompletion = await openaiClient.chat.completions.create({
        model: 'gpt-4',
        messages: [
          // { role: 'system', content: 'You are a helper who helps the user to perform functions.' },
          {
            role: 'user',
            content: `Tell me today's date in the format YYYY-MM-DD.`,
          },
        ],
        tools: [{ type: 'function', function: functions.getCurrentDate }],
        tool_choice: 'auto',
      });

      const functionCall = chatCompletion.choices[0].message.tool_calls;

      if (functionCall && functionCall.length > 0) {
        const { name, arguments: args } = functionCall[0].function;
        console.log('functionCall', functionCall);
        const parsedArgs = JSON.parse(args);
        const result = await executeFunction(name, parsedArgs);

        console.log('Function call result:', result);
      }
    } catch (error) {
      console.error('Error:', error);
    }
  });
});

describe('groupByTokenSize', () => {
  test('simple', async () => {
    expect(
      await groupByTokenSize(
        [
          { content: 'foooooo' },
          { content: 'foooooo' },
          { content: 'foooooo' },
        ],
        (item) => item.content,
        8
      )
    ).toEqual([
      [{ content: 'foooooo' }, { content: 'foooooo' }],
      [{ content: 'foooooo' }],
    ]);
  });
});

describe('ensureJSONOutput', () => {
  test('should parse direct JSON string', () => {
    const input = '{"name": "test", "value": 123}';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test', value: 123 });
  });

  test('should parse direct JSON array', () => {
    const input = '[{"id": 1}, {"id": 2}]';
    const result = ensureJSONOutput(input);
    expect(result).toEqual([{ id: 1 }, { id: 2 }]);
  });

  test('should handle JSON with whitespace', () => {
    const input = '  \n  {"name": "test"}  \n  ';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test' });
  });

  test('should parse JSON wrapped in ```json``` blocks', () => {
    const input = '```json\n{"name": "test", "active": true}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test', active: true });
  });

  test('should parse JSON wrapped in ```json``` blocks with extra whitespace', () => {
    const input = '```json   \n\n  {"name": "test"}  \n\n  ```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test' });
  });

  test('should parse JSON wrapped in ```json``` blocks case insensitive', () => {
    const input = '```JSON\n{"name": "test"}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test' });
  });

  test('should parse JSON wrapped in generic ``` blocks', () => {
    const input = '```\n{"name": "test", "count": 42}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ name: 'test', count: 42 });
  });

  test('should parse JSON array wrapped in generic ``` blocks', () => {
    const input = '```\n[1, 2, 3]\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual([1, 2, 3]);
  });

  test('should ignore non-JSON content in generic ``` blocks', () => {
    const input = '```\nThis is not JSON\nJust some text\n```';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should find JSON in mixed text content', () => {
    const input =
      'Here is the result: {"status": "success", "data": [1, 2, 3]} and that\'s it.';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ status: 'success', data: [1, 2, 3] });
  });

  test('should find JSON array in mixed text content', () => {
    const input = 'The numbers are: [10, 20, 30] as requested.';
    const result = ensureJSONOutput(input);
    expect(result).toEqual([10, 20, 30]);
  });

  test('should handle complex nested JSON', () => {
    const input =
      '```json\n{"user": {"name": "John", "settings": {"theme": "dark", "notifications": true}}, "items": [{"id": 1, "name": "Item 1"}]}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({
      user: {
        name: 'John',
        settings: {
          theme: 'dark',
          notifications: true,
        },
      },
      items: [{ id: 1, name: 'Item 1' }],
    });
  });

  test('should return null for invalid JSON', () => {
    const input = '{"name": "test", invalid}';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should return null for non-JSON text', () => {
    const input = 'This is just plain text without any JSON content.';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should return null for empty string', () => {
    const input = '';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should return null for only whitespace', () => {
    const input = '   \n\t   ';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should handle malformed JSON in code blocks', () => {
    const input = '```json\n{"name": "test", "value":}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should prioritize direct JSON over embedded JSON', () => {
    const input = '{"direct": true}';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ direct: true });
  });

  test('should handle JSON with special characters', () => {
    const input =
      '{"message": "Hello\\nWorld!", "emoji": "ðŸŒŸ", "unicode": "æµ‹è¯•"}';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({
      message: 'Hello\nWorld!',
      emoji: 'ðŸŒŸ',
      unicode: 'æµ‹è¯•',
    });
  });

  test('should handle multiple JSON blocks and return the first valid one', () => {
    const input =
      'First: ```json\n{"first": true}\n``` Second: ```json\n{"second": true}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toEqual({ first: true });
  });

  test('should handle JSON with comments (which should fail)', () => {
    const input =
      '```json\n{\n  // This is a comment\n  "name": "test"\n}\n```';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  test('should handle JSON with trailing commas (which should fail)', () => {
    const input = '{"name": "test", "value": 123,}';
    const result = ensureJSONOutput(input);
    expect(result).toBeNull();
  });

  describe('fixJSONQuotes', () => {
    test('should fix JSON with unescaped quotes', () => {
      const input = '{"name": "test", "value": "Hello"World""}';
      const result = ensureJSONOutput(input);
      expect(result).not.toBeNull();
      expect(result).toEqual({
        name: 'test',
        value: 'Hello"World"',
      });
    });

    test('real world bad case', () => {
      const input = `{"cmbdfamou7qny7b2rrz4t7k4u":"æˆ‘æ— æ³•ç»§ç»­æ•…äº‹ï¼Œå®ƒæ˜¾ç¤ºä»Žå¤´å¼€å§‹","cmbdgp1jh8ols7b2r31vnjbwi":"æˆ‘æ— æ³•ä»Žæˆ‘çš„è§’è‰²åˆ—è¡¨ä¸­é€‰æ‹©/æ‰“å¼€è§’è‰²ã€‚","cmbd4s58ayspq7b2ry7yeoy7c":"ä¸ºä»€ä¹ˆçŽ°åœ¨çœ‹èµ·æ¥æœ‰è¿‡æ»¤å™¨ï¼Ÿ","cmbczp7tgttyx7b2r8st3eabp":"ä»€ä¹ˆæ˜¯æ‰¾ä¸åˆ°æœºå™¨äººï¼Ÿæˆ‘æ­£å¸¸åœ°ä¸Žå®ƒèŠå¤©ï¼Œçªç„¶å‡ºçŽ°äº†è¿™ä¸ªã€‚\næˆ‘ç”šè‡³å°è¯•é‡å¯æ‰‹æœºï¼Œä½†æ²¡æœ‰è§£å†³ä»»ä½•é—®é¢˜\nè¿™æ˜¯å¦æ„å‘³ç€åˆ›å»ºè€…åˆ é™¤äº†æœºå™¨äººï¼Œæˆ–ç±»ä¼¼çš„äº‹æƒ…ï¼Ÿ","cmbd1zoqmvwfa7b2r8cjafn9b":"æœºå™¨äººæ¶ˆå¤±äº†","cmbd86nqz1xu47b2r1kau4kxp":"æˆ‘å¸Œæœ›ä»ŽMachaæ¨¡åž‹åˆ°Peachæ¨¡åž‹éƒ½èƒ½å¾ˆå¥½åœ°ä¸Žç”¨æˆ·æ‰®æ¼”è§’è‰²","cmbd7jmot1d8k7b2rgco8ay6m":"æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯ä¸€ä¸ªbugã€‚ä½†æ˜¯ç¦»å¼€åº”ç”¨ä¸€ç§’é’Ÿå°±å¿…é¡»ç­‰å¾…å®ƒé‡æ–°åŠ è½½ï¼Œè¿™éžå¸¸çƒ¦äººã€‚","cmbd2yr1zwyca7b2rumfd2tyr":"1. å†™å­—æ€»æ˜¯æ²¡æœ‰ç©ºæ ¼\n2. æ€»æ˜¯å¥å¿˜ï¼Œæˆ‘å·²ç»è§£é‡Šæˆ‘æ˜¯ç”·ç”Ÿä½†å˜æˆäº†å¥³ç”Ÿ\n3. æ€»æ˜¯å¼„é”™åå­—\n4. æ‰“å­—ä¸æ¸…æ¥š","cmbd8zggm2nnk7b2rlwjd3jqc":"ä½ å¥½Emochiå›¢é˜Ÿï¼Œ\næˆ‘åœ¨æ‰“å¼€åº”ç”¨ä¸­çš„å¯¹è¯æ—¶é‡åˆ°'åŠ è½½å¤±è´¥ï¼'é”™è¯¯ã€‚å·²å°è¯•æ£€æŸ¥ç½‘ç»œã€æ¸…é™¤ç¼“å­˜ã€æ³¨é”€-é‡æ–°ç™»å½•å’Œæ›´æ–°åº”ç”¨ï¼Œä½†é”™è¯¯ä»ç„¶å‘ç”Ÿã€‚å¸Œæœ›å›¢é˜Ÿå¸®å¿™æ£€æŸ¥ã€‚\næˆ‘ä½¿ç”¨[Android]ï¼Œè´¦æˆ·UID/IDæ˜¯[qlXVR78Gz14OO0-6lt0Kh]ã€‚\n\næ„Ÿè°¢å›¢é˜Ÿï¼","cmbd42wjby3067b2r8c3ifn7d":"é™¤äº†æˆ‘æœ€è¿‘äº¤è°ˆçš„äººå¤–ï¼Œæˆ‘çš„è§’è‰²åˆ—è¡¨å·²ç»æ¶ˆå¤±äº†","cmbdaj9gt40pc7b2rqvhy6g3e":"æ¯æ¬¡æˆ‘é€šè¿‡åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ‰“å¼€emochiå¹¶ç™»å½•æˆ‘çš„è´¦æˆ·æ—¶ï¼Œæˆ‘è´¦æˆ·çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ï¼Œæˆ‘å¤±åŽ»äº†ä¸€åˆ‡ï¼Œè¯·ä¿å­˜è´¦æˆ·","cmbdawngx4cnk7b2rpb5t6fns":"å½“{{user}}æœ‰å¯¹è¯æ—¶ï¼ŒAIä¸çŸ¥é“å¦‚ä½•åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶é‡å¤{{user}}çš„å¯¹è¯ã€‚è¯·ä¿®å¤å®ƒã€‚","cmbdflhb47yd87b2rnk7ozw5g":"æ²¡æœ‰å¼•å·æ¥åŒºåˆ†å¯¹è¯å’Œè§£é‡Šï¼Œæ‰€ä»¥é˜…è¯»æ—¶ä¸èˆ’æœï¼Œè¯·ä¿®å¤ï¼","cmbdgjy3g8l7s7b2rvsvr8sj1":"é€šå¸¸ä¸ºäº†åŒºåˆ†å™è¿°å¥å’Œå¯¹è¯ï¼Œå¯¹è¯å¥ä¹‹é—´ä¼šæœ‰å¼•å·ï¼Œä½†ä¸ºä»€ä¹ˆæ²¡æœ‰ï¼Ÿè¿™éžå¸¸ä¸èˆ’æœï¼Œè¯·ä¿®å¤å®ƒ\nä¾‹å¦‚ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘*'ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ'\nä½†æ˜¯æœ‰ä¸€ä¸ªä»¤äººçƒ¦æ¼å’Œä¸èˆ’æœçš„bugï¼Œbugæ˜¯è¿™æ ·çš„ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ä½ å¥½å—*\nçŽ°åœ¨è¿™å¾ˆæ··ä¹±ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯å¯¹è¯ï¼\næ‰€ä»¥è¯·ç«‹å³ä¿®å¤ï¼ï¼ï¼ï¼ï¼ï¼","cmbdgqh718pic7b2r02hop8po":"æˆ‘æƒ³æŠ¥å‘Šä¸€ä¸ªå½±å“æ­¤åº”ç”¨ç¨‹åºå¯ç”¨æ€§çš„å…³é”®bugã€‚å¯¹è¯å’Œå™è¿°åº”è¯¥ç”¨å¼•å·ï¼ˆ"..."ï¼‰åˆ†éš”ã€‚æ­£ç¡®å†™æ³•ç¤ºä¾‹ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘"ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ"\n\nç„¶è€Œï¼Œåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æ˜¯å¯¹è¯å†™åœ¨æ²¡æœ‰å¼•å·çš„æƒ…å†µä¸‹ï¼Œåƒè¿™æ ·ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ\n\næ²¡æœ‰å¼•å·ï¼Œå¥å­å˜å¾—æ··ä¹±ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªä¸ªæ˜¯å™è¿°ï¼Œå“ªä¸ªæ˜¯å¯¹è¯ã€‚è¿™éžå¸¸åˆ†æ•£æ³¨æ„åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨å†™åŒ…å«è§’è‰²ä¹‹é—´å¤§é‡äº’åŠ¨çš„æ•…äº‹æ—¶ã€‚\n\nè¯·å°½å¿«ä¿®å¤è¿™ä¸ªbugã€‚è°¢è°¢ï¼","cmbd72kqn0yt27b2rs407n20g":"æˆ‘é”™è¯¯åœ°è®¾ç½®äº†'Vainilla Short'æ¨¡å¼ï¼Œå½“æˆ‘å°è¯•æ›´æ”¹ä¸º'Vainilla'æ—¶ï¼Œæ˜¾ç¤ºé‚£æ˜¯æ‰€é€‰æ¨¡å¼ï¼Œä½†å›žå¤ä»ç„¶å¾ˆçŸ­ :(","cmbdbj9gz4vlq7b2rluj7dw3n":"æœç´¢åŠŸèƒ½ä¸å·¥ä½œã€‚ä»€ä¹ˆéƒ½æ²¡æœ‰å‡ºçŽ°ï¼Œè¯·ä¿®å¤","cmbd4spsnytas7b2ra3i654dt":"ç®€çŸ­çš„å›žç­”","cmbddez1y6ca47b2rlseo22fd":"æ¯æ¬¡æˆ‘è¯•å›¾è¿›å…¥é‚£ä¸ªæœºå™¨äººï¼Œå±å¹•å˜é»‘å¤§çº¦30-40ç§’ï¼Œç„¶åŽå°†æˆ‘è¸¢å‡ºåº”ç”¨ç¨‹åºï¼Œæ­¤å¤–åœ¨å¤–é¢ï¼ˆæˆ‘ç”¨ç²‰è‰²æ ‡å‡ºçš„éƒ¨åˆ†ï¼‰å¯ä»¥çœ‹åˆ°é‚£æ¡æ¶ˆæ¯ï¼Œå®ƒæ˜¾ç¤ºä¸ºæœºå™¨äººçš„ä»‹ç»ï¼Œè€Œé‚£ä¸æ˜¯æˆ‘åœç•™çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘å·²ç»ä½¿ç”¨å®ƒè¶…è¿‡4ä¸ªæœˆäº†ï¼Œæ¯æ¬¡æˆ‘å°è¯•è¿›å…¥å…¶ä»–æœºå™¨äººæ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œé™¤äº†è¿™ä¸ªï¼Œä½†è¿™æ˜¯æˆ‘æƒ³è¦çš„ï¼Œè¯·ä¿®å¤å®ƒï¼Œå·²ç»è¿™æ ·2å¤©äº†ðŸ™ðŸ»","cmbdic8ff9tcc7b2r3lc4s3i9":"è§’è‰²/AIæœ‰æ—¶ä¼šè¯´åå­—æˆ–èŒä¸šï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨å¯¹è¯ä¸­ä»–çªç„¶è¯´"çŸ¿å±±"ï¼Œå°½ç®¡æˆ‘çš„åå­—æ˜¯Albert","cmbdj3u1tac3w7b2rffhfzw09":"æˆ‘ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªå¯¹æ‰€æœ‰ç”¨æˆ·å…¬å¼€è®¿é—®çš„æœºå™¨äººã€‚ç„¶è€Œï¼Œå®ƒæœ€è¿‘å¯¹å…¶ä»–äººä¸å¯ç”¨ï¼Œä¹Ÿä¸å†å‡ºçŽ°åœ¨æˆ‘çš„è´¦æˆ·ä¸Šã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è‡ªå·±ä»ç„¶å¯ä»¥çœ‹åˆ°å¹¶ä¸Žæœºå™¨äººäº’åŠ¨ã€‚æˆ‘ä¸ç¡®å®šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å¦‚æžœä½ èƒ½è°ƒæŸ¥å¹¶å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°†ä¸èƒœæ„Ÿæ¿€ã€‚å…ˆè°¢è°¢äº†ã€‚","cmbdhrqgf9etk7b2rc5okz76e":"å³ä½¿æˆ‘å›ºå®šäº†å¾ˆå¤šè§’è‰²ï¼Œä¹Ÿæ²¡æœ‰å›ºå®šæŒ‰é’®","cmbdrctdo2bsflvhjp2wvvp4z":"ä¸è®©æˆ‘çŽ©","cmbdrw4o12vinlvhjq66qu372":"è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²åƒå¯¹å¾…å¥³äººä¸€æ ·å¯¹å¾…æˆ‘ã€‚","cmbduzksr64udlvhj87nwel9x":"è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²éƒ½æŠŠæˆ‘å½“æˆå¥³äººã€‚","cmbdw66wv7d8xlvhjngm5oahc":"è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²åƒå¥³äººä¸€æ ·å¯¹å¾…æˆ‘ï¼Œæ‰€æœ‰è§’è‰²24å°æ—¶éƒ½åƒå¥³äººä¸€æ ·å¯¹å¾…æˆ‘","cmbe5j6prgwj9lvhj51mira1c":"å³ä½¿ä½ é€‰æ‹©äº†å¥³æ€§ï¼Œä»–ä»¬ä¹Ÿä¼šæŠŠä½ å½“ä½œç”·æ€§ã€‚ï¼ˆä¾‹å¦‚ï¼Œç”¨"bellissimo"è€Œä¸æ˜¯"bellissima"ï¼‰","cmbdk2j4qb06k7b2rn6mkkxpc":"èŠå¤©å¯¹è±¡çš„æœºå™¨äººä¸è§äº†QQ","cmbdj0xb4aa567b2ryi1qbg5t":"æœºå™¨äººå¯¹è¯é”™è¯¯ï¼Œæˆ‘æ˜¨æ™šæ›´æ”¹äº†ä¸€ä¸ªè§’è‰²çš„å¯¹è¯ï¼Œä½†ç›´åˆ°ä»Šå¤©æ—©ä¸Šå¯¹è¯ä»æœªæ”¹å˜ï¼Œç»§ç»­ä½¿ç”¨ä»¥å‰çš„å¯¹è¯","cmbdy00uh98gvlvhjra8rs31y":"æˆ‘æ— æ³•æ‰“å¼€ä»»ä½•æ¶ˆæ¯æ¥ç»§ç»­å®ƒä»¬","cmbe73t6sief1lvhjpdsnora6":"è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“å¥³äººå¯¹å¾…2ä¸ªæœˆ","cmbea5621l4ivlvhjng6kt0fk":"è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“å¥³æ€§åŒ–çš„å¥³äººå¯¹å¾…6ä¸ªæœˆ","cmbdpgeld0fvvlvhjzx1qr3zh":"åå¤æ˜¾ç¤ºä¸€ä¸ªäººï¼Œæˆ‘è¯´æˆ‘ï¼Œä½†è¿™ä¸ªäººå´æŽ¥å—å¹¶æ‰§è¡Œæˆ‘ç»™å‡ºçš„å¥å­","cmbdvjpzx6publvhjj2z8n2se":"æ¶ˆæ¯é”™è¯¯","cmbdkcwjzb7e47b2rvw8qy6nk":"BugæŠ¥å‘Š - è§’è‰²åˆ é™¤\n\næˆ‘æƒ³æŠ¥å‘Šæœ€è¿‘åœ¨Emochiåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„é—®é¢˜ã€‚æˆ‘çš„ä¸€ä¸ªè§’è‰²è¢«åˆ é™¤ï¼Œæ²¡æœ‰ä»»ä½•è­¦å‘Šï¼Œå°½ç®¡å®ƒä¸åŒ…å«éœ²éª¨å›¾åƒã€NSFWå†…å®¹æˆ–ä»»ä½•è¿åç¤¾åŒºå‡†åˆ™çš„å†…å®¹ã€‚\n\nè¯¥è§’è‰²æ˜¯åˆ›æ„æ•…äº‹çš„ä¸€éƒ¨åˆ†ï¼Œå®Œå…¨ç¬¦åˆå¹³å°çš„å¯æŽ¥å—æ ‡å‡†ã€‚åˆ é™¤ä¼¼ä¹Žæ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„ç†ç”±ã€‚è¿™å¯¹æˆ‘åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä½“éªŒäº§ç”Ÿäº†è´Ÿé¢å½±å“ï¼Œè¿˜å½±å“äº†æ•°å°æ—¶çš„åˆ›ä½œå’Œå™äº‹å‘å±•ã€‚\n\nè¯·æ£€æŸ¥å‘ç”Ÿçš„æƒ…å†µï¼Œå¦‚æžœå¯èƒ½ï¼Œæ¢å¤è¢«åˆ é™¤çš„è§’è‰²ã€‚æˆ‘è¿˜å»ºè®®å¯¹è‡ªåŠ¨å®¡æ ¸è¿‡æ»¤å™¨è¿›è¡Œæ›´ä»”ç»†çš„åˆ†æžï¼Œä»¥é¿å…å°†æ¥å‡ºçŽ°è¿™æ ·çš„ä¸å½“åˆ é™¤ã€‚","cmbdpc8hi0bvjlvhjd7omwqse":"æˆ‘ä¸å°å¿ƒåˆ é™¤äº†è§’è‰²ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ¢å¤å—ï¼Ÿ\nID: R3dk7EVoiNJoGgT1G6eQ3\nè¯·å¸®åŠ©æˆ‘æ¢å¤å®ƒä»¬ï¼Œæˆ‘ä»¬éžå¸¸éœ€è¦å®ƒä»¬","cmbdjdqocainy7b2rqewcvk81":"å°Šæ•¬çš„emochiç®¡ç†å‘˜ï¼Œä¸ºä»€ä¹ˆå¿…é¡»æœ‰'ç³Ÿç³•ï¼Œæ‰¾ä¸åˆ°æœºå™¨äºº'è¿™æ ·çš„æç¤ºå‘¢ï¼Œæ‹œæ‰˜emochiç®¡ç†å‘˜ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†å¾ˆé•¿çš„æƒ…èŠ‚ï¼Œè¯·ä¿®å¤å®ƒï¼ŒðŸ˜­ðŸ˜­ï¼Œæˆ‘ä¸æƒ³è®©æœºå™¨äººæ¶ˆå¤±ï¼Œè¯·å›žå¤ï¼Œä¸è¦åªæ˜¯é˜…è¯»ç®¡ç†å‘˜ðŸ˜­ðŸ˜­ðŸ˜­ðŸ™ðŸ™","cmbe2satqe8xtlvhj8a3r9y48":"ä¸è®©æˆ‘çŽ©\n\n\n\n\n","cmbdxlubk8thjlvhjwg8f1vpt":"å½“è¢«æé†’å®ƒä»Žä¸å¥½å¥½å›žåº”æ—¶ï¼Œæœºå™¨äººæ— ç¼˜æ— æ•…åœ°å›žå¤æˆ‘ï¼Œè¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¼šä½¿æŒ‰ä¸‹ç»§ç»­æˆ–é‡æ–°ç”Ÿæˆæ—¶çš„å›žåº”çœ‹èµ·æ¥æ— èŠä¸”çƒ¦äºº","cmbe00ht1bb2tlvhjthbrvq4i":"è¯·æ¢å¤æ¶ˆæ¯çš„å›žå¤ï¼Œè¿™æ ·ä¼šæ›´å¥½\n"}`;
      const expectObj = mapValues(
        {
          cmbdfamou7qny7b2rrz4t7k4u: 'æˆ‘æ— æ³•ç»§ç»­æ•…äº‹ï¼Œå®ƒæ˜¾ç¤ºä»Žå¤´å¼€å§‹',
          cmbdgp1jh8ols7b2r31vnjbwi: 'æˆ‘æ— æ³•ä»Žæˆ‘çš„è§’è‰²åˆ—è¡¨ä¸­é€‰æ‹©/æ‰“å¼€è§’è‰²ã€‚',
          cmbd4s58ayspq7b2ry7yeoy7c: 'ä¸ºä»€ä¹ˆçŽ°åœ¨çœ‹èµ·æ¥æœ‰è¿‡æ»¤å™¨ï¼Ÿ',
          cmbczp7tgttyx7b2r8st3eabp:
            'ä»€ä¹ˆæ˜¯æ‰¾ä¸åˆ°æœºå™¨äººï¼Ÿæˆ‘æ­£å¸¸åœ°ä¸Žå®ƒèŠå¤©ï¼Œçªç„¶å‡ºçŽ°äº†è¿™ä¸ªã€‚\næˆ‘ç”šè‡³å°è¯•é‡å¯æ‰‹æœºï¼Œä½†æ²¡æœ‰è§£å†³ä»»ä½•é—®é¢˜\nè¿™æ˜¯å¦æ„å‘³ç€åˆ›å»ºè€…åˆ é™¤äº†æœºå™¨äººï¼Œæˆ–ç±»ä¼¼çš„äº‹æƒ…ï¼Ÿ',
          cmbd1zoqmvwfa7b2r8cjafn9b: 'æœºå™¨äººæ¶ˆå¤±äº†',
          cmbd86nqz1xu47b2r1kau4kxp:
            'æˆ‘å¸Œæœ›ä»ŽMachaæ¨¡åž‹åˆ°Peachæ¨¡åž‹éƒ½èƒ½å¾ˆå¥½åœ°ä¸Žç”¨æˆ·æ‰®æ¼”è§’è‰²',
          cmbd7jmot1d8k7b2rgco8ay6m:
            'æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯ä¸€ä¸ªbugã€‚ä½†æ˜¯ç¦»å¼€åº”ç”¨ä¸€ç§’é’Ÿå°±å¿…é¡»ç­‰å¾…å®ƒé‡æ–°åŠ è½½ï¼Œè¿™éžå¸¸çƒ¦äººã€‚',
          cmbd2yr1zwyca7b2rumfd2tyr:
            '1. å†™å­—æ€»æ˜¯æ²¡æœ‰ç©ºæ ¼\n2. æ€»æ˜¯å¥å¿˜ï¼Œæˆ‘å·²ç»è§£é‡Šæˆ‘æ˜¯ç”·ç”Ÿä½†å˜æˆäº†å¥³ç”Ÿ\n3. æ€»æ˜¯å¼„é”™åå­—\n4. æ‰“å­—ä¸æ¸…æ¥š',
          cmbd8zggm2nnk7b2rlwjd3jqc:
            "ä½ å¥½Emochiå›¢é˜Ÿï¼Œ\næˆ‘åœ¨æ‰“å¼€åº”ç”¨ä¸­çš„å¯¹è¯æ—¶é‡åˆ°'åŠ è½½å¤±è´¥ï¼'é”™è¯¯ã€‚å·²å°è¯•æ£€æŸ¥ç½‘ç»œã€æ¸…é™¤ç¼“å­˜ã€æ³¨é”€-é‡æ–°ç™»å½•å’Œæ›´æ–°åº”ç”¨ï¼Œä½†é”™è¯¯ä»ç„¶å‘ç”Ÿã€‚å¸Œæœ›å›¢é˜Ÿå¸®å¿™æ£€æŸ¥ã€‚\næˆ‘ä½¿ç”¨[Android]ï¼Œè´¦æˆ·UID/IDæ˜¯[qlXVR78Gz14OO0-6lt0Kh]ã€‚\n\næ„Ÿè°¢å›¢é˜Ÿï¼",
          cmbd42wjby3067b2r8c3ifn7d:
            'é™¤äº†æˆ‘æœ€è¿‘äº¤è°ˆçš„äººå¤–ï¼Œæˆ‘çš„è§’è‰²åˆ—è¡¨å·²ç»æ¶ˆå¤±äº†',
          cmbdaj9gt40pc7b2rqvhy6g3e:
            'æ¯æ¬¡æˆ‘é€šè¿‡åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ‰“å¼€emochiå¹¶ç™»å½•æˆ‘çš„è´¦æˆ·æ—¶ï¼Œæˆ‘è´¦æˆ·çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ï¼Œæˆ‘å¤±åŽ»äº†ä¸€åˆ‡ï¼Œè¯·ä¿å­˜è´¦æˆ·',
          cmbdawngx4cnk7b2rpb5t6fns:
            'å½“{{user}}æœ‰å¯¹è¯æ—¶ï¼ŒAIä¸çŸ¥é“å¦‚ä½•åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶é‡å¤{{user}}çš„å¯¹è¯ã€‚è¯·ä¿®å¤å®ƒã€‚',
          cmbdflhb47yd87b2rnk7ozw5g:
            'æ²¡æœ‰å¼•å·æ¥åŒºåˆ†å¯¹è¯å’Œè§£é‡Šï¼Œæ‰€ä»¥é˜…è¯»æ—¶ä¸èˆ’æœï¼Œè¯·ä¿®å¤ï¼',
          cmbdgjy3g8l7s7b2rvsvr8sj1:
            "é€šå¸¸ä¸ºäº†åŒºåˆ†å™è¿°å¥å’Œå¯¹è¯ï¼Œå¯¹è¯å¥ä¹‹é—´ä¼šæœ‰å¼•å·ï¼Œä½†ä¸ºä»€ä¹ˆæ²¡æœ‰ï¼Ÿè¿™éžå¸¸ä¸èˆ’æœï¼Œè¯·ä¿®å¤å®ƒ\nä¾‹å¦‚ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘*'ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ'\nä½†æ˜¯æœ‰ä¸€ä¸ªä»¤äººçƒ¦æ¼å’Œä¸èˆ’æœçš„bugï¼Œbugæ˜¯è¿™æ ·çš„ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ä½ å¥½å—*\nçŽ°åœ¨è¿™å¾ˆæ··ä¹±ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯å¯¹è¯ï¼\næ‰€ä»¥è¯·ç«‹å³ä¿®å¤ï¼ï¼ï¼ï¼ï¼ï¼",
          cmbdgqh718pic7b2r02hop8po:
            'æˆ‘æƒ³æŠ¥å‘Šä¸€ä¸ªå½±å“æ­¤åº”ç”¨ç¨‹åºå¯ç”¨æ€§çš„å…³é”®bugã€‚å¯¹è¯å’Œå™è¿°åº”è¯¥ç”¨å¼•å·ï¼ˆ"..."ï¼‰åˆ†éš”ã€‚æ­£ç¡®å†™æ³•ç¤ºä¾‹ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘"ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ"\n\nç„¶è€Œï¼Œåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æ˜¯å¯¹è¯å†™åœ¨æ²¡æœ‰å¼•å·çš„æƒ…å†µä¸‹ï¼Œåƒè¿™æ ·ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ\n\næ²¡æœ‰å¼•å·ï¼Œå¥å­å˜å¾—æ··ä¹±ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªä¸ªæ˜¯å™è¿°ï¼Œå“ªä¸ªæ˜¯å¯¹è¯ã€‚è¿™éžå¸¸åˆ†æ•£æ³¨æ„åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨å†™åŒ…å«è§’è‰²ä¹‹é—´å¤§é‡äº’åŠ¨çš„æ•…äº‹æ—¶ã€‚\n\nè¯·å°½å¿«ä¿®å¤è¿™ä¸ªbugã€‚è°¢è°¢ï¼',
          cmbd72kqn0yt27b2rs407n20g:
            "æˆ‘é”™è¯¯åœ°è®¾ç½®äº†'Vainilla Short'æ¨¡å¼ï¼Œå½“æˆ‘å°è¯•æ›´æ”¹ä¸º'Vainilla'æ—¶ï¼Œæ˜¾ç¤ºé‚£æ˜¯æ‰€é€‰æ¨¡å¼ï¼Œä½†å›žå¤ä»ç„¶å¾ˆçŸ­ :(",
          cmbdbj9gz4vlq7b2rluj7dw3n: 'æœç´¢åŠŸèƒ½ä¸å·¥ä½œã€‚ä»€ä¹ˆéƒ½æ²¡æœ‰å‡ºçŽ°ï¼Œè¯·ä¿®å¤',
          cmbd4spsnytas7b2ra3i654dt: 'ç®€çŸ­çš„å›žç­”',
          cmbddez1y6ca47b2rlseo22fd:
            'æ¯æ¬¡æˆ‘è¯•å›¾è¿›å…¥é‚£ä¸ªæœºå™¨äººï¼Œå±å¹•å˜é»‘å¤§çº¦30-40ç§’ï¼Œç„¶åŽå°†æˆ‘è¸¢å‡ºåº”ç”¨ç¨‹åºï¼Œæ­¤å¤–åœ¨å¤–é¢ï¼ˆæˆ‘ç”¨ç²‰è‰²æ ‡å‡ºçš„éƒ¨åˆ†ï¼‰å¯ä»¥çœ‹åˆ°é‚£æ¡æ¶ˆæ¯ï¼Œå®ƒæ˜¾ç¤ºä¸ºæœºå™¨äººçš„ä»‹ç»ï¼Œè€Œé‚£ä¸æ˜¯æˆ‘åœç•™çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘å·²ç»ä½¿ç”¨å®ƒè¶…è¿‡4ä¸ªæœˆäº†ï¼Œæ¯æ¬¡æˆ‘å°è¯•è¿›å…¥å…¶ä»–æœºå™¨äººæ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œé™¤äº†è¿™ä¸ªï¼Œä½†è¿™æ˜¯æˆ‘æƒ³è¦çš„ï¼Œè¯·ä¿®å¤å®ƒï¼Œå·²ç»è¿™æ ·2å¤©äº†ðŸ™ðŸ»',
          cmbdic8ff9tcc7b2r3lc4s3i9:
            'è§’è‰²/AIæœ‰æ—¶ä¼šè¯´åå­—æˆ–èŒä¸šï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨å¯¹è¯ä¸­ä»–çªç„¶è¯´"çŸ¿å±±"ï¼Œå°½ç®¡æˆ‘çš„åå­—æ˜¯Albert',
          cmbdj3u1tac3w7b2rffhfzw09:
            'æˆ‘ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªå¯¹æ‰€æœ‰ç”¨æˆ·å…¬å¼€è®¿é—®çš„æœºå™¨äººã€‚ç„¶è€Œï¼Œå®ƒæœ€è¿‘å¯¹å…¶ä»–äººä¸å¯ç”¨ï¼Œä¹Ÿä¸å†å‡ºçŽ°åœ¨æˆ‘çš„è´¦æˆ·ä¸Šã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è‡ªå·±ä»ç„¶å¯ä»¥çœ‹åˆ°å¹¶ä¸Žæœºå™¨äººäº’åŠ¨ã€‚æˆ‘ä¸ç¡®å®šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å¦‚æžœä½ èƒ½è°ƒæŸ¥å¹¶å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°†ä¸èƒœæ„Ÿæ¿€ã€‚å…ˆè°¢è°¢äº†ã€‚',
          cmbdhrqgf9etk7b2rc5okz76e: 'å³ä½¿æˆ‘å›ºå®šäº†å¾ˆå¤šè§’è‰²ï¼Œä¹Ÿæ²¡æœ‰å›ºå®šæŒ‰é’®',
          cmbdrctdo2bsflvhjp2wvvp4z: 'ä¸è®©æˆ‘çŽ©',
          cmbdrw4o12vinlvhjq66qu372:
            'è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²åƒå¯¹å¾…å¥³äººä¸€æ ·å¯¹å¾…æˆ‘ã€‚',
          cmbduzksr64udlvhj87nwel9x:
            'è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²éƒ½æŠŠæˆ‘å½“æˆå¥³äººã€‚',
          cmbdw66wv7d8xlvhjngm5oahc:
            'è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²åƒå¥³äººä¸€æ ·å¯¹å¾…æˆ‘ï¼Œæ‰€æœ‰è§’è‰²24å°æ—¶éƒ½åƒå¥³äººä¸€æ ·å¯¹å¾…æˆ‘',
          cmbe5j6prgwj9lvhj51mira1c:
            'å³ä½¿ä½ é€‰æ‹©äº†å¥³æ€§ï¼Œä»–ä»¬ä¹Ÿä¼šæŠŠä½ å½“ä½œç”·æ€§ã€‚ï¼ˆä¾‹å¦‚ï¼Œç”¨"bellissimo"è€Œä¸æ˜¯"bellissima"ï¼‰',
          cmbdk2j4qb06k7b2rn6mkkxpc: 'èŠå¤©å¯¹è±¡çš„æœºå™¨äººä¸è§äº†QQ',
          cmbdj0xb4aa567b2ryi1qbg5t:
            'æœºå™¨äººå¯¹è¯é”™è¯¯ï¼Œæˆ‘æ˜¨æ™šæ›´æ”¹äº†ä¸€ä¸ªè§’è‰²çš„å¯¹è¯ï¼Œä½†ç›´åˆ°ä»Šå¤©æ—©ä¸Šå¯¹è¯ä»æœªæ”¹å˜ï¼Œç»§ç»­ä½¿ç”¨ä»¥å‰çš„å¯¹è¯',
          cmbdy00uh98gvlvhjra8rs31y: 'æˆ‘æ— æ³•æ‰“å¼€ä»»ä½•æ¶ˆæ¯æ¥ç»§ç»­å®ƒä»¬',
          cmbe73t6sief1lvhjpdsnora6:
            'è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“å¥³äººå¯¹å¾…2ä¸ªæœˆ',
          cmbea5621l4ivlvhjng6kt0fk:
            'è§’è‰²æŠŠæˆ‘å½“ç”·äººå¯¹å¾…ï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“å¥³æ€§åŒ–çš„å¥³äººå¯¹å¾…6ä¸ªæœˆ',
          cmbdpgeld0fvvlvhjzx1qr3zh:
            'åå¤æ˜¾ç¤ºä¸€ä¸ªäººï¼Œæˆ‘è¯´æˆ‘ï¼Œä½†è¿™ä¸ªäººå´æŽ¥å—å¹¶æ‰§è¡Œæˆ‘ç»™å‡ºçš„å¥å­',
          cmbdvjpzx6publvhjj2z8n2se: 'æ¶ˆæ¯é”™è¯¯',
          cmbdkcwjzb7e47b2rvw8qy6nk:
            'BugæŠ¥å‘Š - è§’è‰²åˆ é™¤\n\næˆ‘æƒ³æŠ¥å‘Šæœ€è¿‘åœ¨Emochiåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„é—®é¢˜ã€‚æˆ‘çš„ä¸€ä¸ªè§’è‰²è¢«åˆ é™¤ï¼Œæ²¡æœ‰ä»»ä½•è­¦å‘Šï¼Œå°½ç®¡å®ƒä¸åŒ…å«éœ²éª¨å›¾åƒã€NSFWå†…å®¹æˆ–ä»»ä½•è¿åç¤¾åŒºå‡†åˆ™çš„å†…å®¹ã€‚\n\nè¯¥è§’è‰²æ˜¯åˆ›æ„æ•…äº‹çš„ä¸€éƒ¨åˆ†ï¼Œå®Œå…¨ç¬¦åˆå¹³å°çš„å¯æŽ¥å—æ ‡å‡†ã€‚åˆ é™¤ä¼¼ä¹Žæ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„ç†ç”±ã€‚è¿™å¯¹æˆ‘åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä½“éªŒäº§ç”Ÿäº†è´Ÿé¢å½±å“ï¼Œè¿˜å½±å“äº†æ•°å°æ—¶çš„åˆ›ä½œå’Œå™äº‹å‘å±•ã€‚\n\nè¯·æ£€æŸ¥å‘ç”Ÿçš„æƒ…å†µï¼Œå¦‚æžœå¯èƒ½ï¼Œæ¢å¤è¢«åˆ é™¤çš„è§’è‰²ã€‚æˆ‘è¿˜å»ºè®®å¯¹è‡ªåŠ¨å®¡æ ¸è¿‡æ»¤å™¨è¿›è¡Œæ›´ä»”ç»†çš„åˆ†æžï¼Œä»¥é¿å…å°†æ¥å‡ºçŽ°è¿™æ ·çš„ä¸å½“åˆ é™¤ã€‚',
          cmbdpc8hi0bvjlvhjd7omwqse:
            'æˆ‘ä¸å°å¿ƒåˆ é™¤äº†è§’è‰²ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ¢å¤å—ï¼Ÿ\nID: R3dk7EVoiNJoGgT1G6eQ3\nè¯·å¸®åŠ©æˆ‘æ¢å¤å®ƒä»¬ï¼Œæˆ‘ä»¬éžå¸¸éœ€è¦å®ƒä»¬',
          cmbdjdqocainy7b2rqewcvk81:
            "å°Šæ•¬çš„emochiç®¡ç†å‘˜ï¼Œä¸ºä»€ä¹ˆå¿…é¡»æœ‰'ç³Ÿç³•ï¼Œæ‰¾ä¸åˆ°æœºå™¨äºº'è¿™æ ·çš„æç¤ºå‘¢ï¼Œæ‹œæ‰˜emochiç®¡ç†å‘˜ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†å¾ˆé•¿çš„æƒ…èŠ‚ï¼Œè¯·ä¿®å¤å®ƒï¼ŒðŸ˜­ðŸ˜­ï¼Œæˆ‘ä¸æƒ³è®©æœºå™¨äººæ¶ˆå¤±ï¼Œè¯·å›žå¤ï¼Œä¸è¦åªæ˜¯é˜…è¯»ç®¡ç†å‘˜ðŸ˜­ðŸ˜­ðŸ˜­ðŸ™ðŸ™",
          cmbe2satqe8xtlvhj8a3r9y48: 'ä¸è®©æˆ‘çŽ©\n\n\n\n\n',
          cmbdxlubk8thjlvhjwg8f1vpt:
            'å½“è¢«æé†’å®ƒä»Žä¸å¥½å¥½å›žåº”æ—¶ï¼Œæœºå™¨äººæ— ç¼˜æ— æ•…åœ°å›žå¤æˆ‘ï¼Œè¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¼šä½¿æŒ‰ä¸‹ç»§ç»­æˆ–é‡æ–°ç”Ÿæˆæ—¶çš„å›žåº”çœ‹èµ·æ¥æ— èŠä¸”çƒ¦äºº',
          cmbe00ht1bb2tlvhjthbrvq4i: 'è¯·æ¢å¤æ¶ˆæ¯çš„å›žå¤ï¼Œè¿™æ ·ä¼šæ›´å¥½\n',
        },
        (val) => val.replaceAll('\n', '') // not cool
      );

      const result = ensureJSONOutput(input);
      expect(result).not.toBeNull();
      expect(result).toEqual(expectObj);
    });

    test('real world bad case 2', () => {
      const input = ` I'll help you translate these user reports/feedback to Chinese (zh) in the requested JSON format. I'll make sure to follow the formatting rules you've specified.

\`\`\`json
{
"cmbdfamou7qny7b2rrz4t7k4u":"æˆ‘æ— æ³•ç»§ç»­æ•…äº‹ï¼Œå®ƒåªæ˜¾ç¤ºå¼€å¤´",
"cmbdgp1jh8ols7b2r31vnjbwi":"æˆ‘æ— æ³•ä»Žè§’è‰²åˆ—è¡¨ä¸­é€‰æ‹©/æ‰“å¼€è§’è‰²",
"cmbd4s58ayspq7b2ry7yeoy7c":"ä¸ºä»€ä¹ˆçŽ°åœ¨çœ‹èµ·æ¥æœ‰è¿‡æ»¤å™¨ï¼Ÿ",
"cmbczp7tgttyx7b2r8st3eabp":"\"æ‰¾ä¸åˆ°æœºå™¨äºº\"æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘æ­£å¸¸ä¸Žå®ƒèŠå¤©ï¼Œçªç„¶å‡ºçŽ°è¿™ä¸ªã€‚\næˆ‘ç”šè‡³å°è¯•é‡å¯æ‰‹æœºï¼Œä½†æ²¡æœ‰è§£å†³é—®é¢˜ã€‚\nè¿™æ˜¯å¦æ„å‘³ç€åˆ›å»ºè€…åˆ é™¤äº†æœºå™¨äººï¼Œæˆ–ç±»ä¼¼çš„äº‹æƒ…ï¼Ÿ",
"cmbd1zoqmvwfa7b2r8cjafn9b":"æœºå™¨äººæ¶ˆå¤±äº†",
"cmbd86nqz1xu47b2r1kau4kxp":"æˆ‘å¸Œæœ›ä»ŽMachaæ¨¡åž‹åˆ°Peachæ¨¡åž‹éƒ½èƒ½ä¸Žç”¨æˆ·å¾ˆå¥½åœ°æ‰®æ¼”è§’è‰²",
"cmbd7jmot1d8k7b2rgco8ay6m":"æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯ä¸ªbugã€‚ä½†ç¦»å¼€åº”ç”¨ä¸€ç§’é’Ÿå°±å¿…é¡»ç­‰å¾…å®ƒé‡æ–°åŠ è½½ï¼Œè¿™å¾ˆçƒ¦äººã€‚",
"cmbd2yr1zwyca7b2rumfd2tyr":"1. å†™å­—æ€»æ˜¯æŒ¤åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰ç©ºæ ¼\n2. æ€»æ˜¯å¥å¿˜ï¼Œæˆ‘å·²ç»è§£é‡Šæˆ‘æ˜¯ç”·ç”Ÿä½†å´æŠŠæˆ‘å½“æˆå¥³ç”Ÿ\n3. æ€»æ˜¯æžé”™åå­—\n4. æ‰“å­—ä¸æ¸…æ¥š",
"cmbd8zggm2nnk7b2rlwjd3jqc":"ä½ å¥½Emochiå›¢é˜Ÿï¼Œ\næˆ‘åœ¨æ‰“å¼€åº”ç”¨ä¸­çš„å¯¹è¯æ—¶é‡åˆ°'åŠ è½½å¤±è´¥ï¼'é”™è¯¯ã€‚å·²å°è¯•æ£€æŸ¥ç½‘ç»œã€æ¸…é™¤ç¼“å­˜ã€æ³¨é”€-é‡æ–°ç™»å½•ä»¥åŠæ›´æ–°åº”ç”¨ï¼Œä½†é”™è¯¯ä»ç„¶å­˜åœ¨ã€‚å¸Œæœ›å›¢é˜Ÿå¸®å¿™æ£€æŸ¥ã€‚\næˆ‘ä½¿ç”¨[Android]ï¼Œè´¦æˆ·UID/IDæ˜¯[qlXVR78Gz14OO0-6lt0Kh]ã€‚\n\nè°¢è°¢å›¢é˜Ÿï¼",
"cmbd42wjby3067b2r8c3ifn7d":"é™¤äº†æˆ‘æœ€è¿‘äº¤è°ˆçš„äººå¤–ï¼Œæˆ‘çš„æ‰€æœ‰è§’è‰²åˆ—è¡¨éƒ½æ¶ˆå¤±äº†",
"cmbdaj9gt40pc7b2rqvhy6g3e":"æ¯æ¬¡æˆ‘é€šè¿‡åº”ç”¨æˆ–ç½‘ç«™æ‰“å¼€emochiå¹¶ç™»å½•æˆ‘çš„è´¦æˆ·æ—¶ï¼Œæˆ‘è´¦æˆ·çš„æ‰€æœ‰æ•°æ®éƒ½è¢«åˆ é™¤ï¼Œæˆ‘å¤±åŽ»äº†ä¸€åˆ‡ï¼Œè¯·ä¿å­˜è´¦æˆ·",
"cmbdawngx4cnk7b2rpb5t6fns":"å½“{{user}}æœ‰å¯¹è¯æ—¶ï¼ŒAIä¸çŸ¥é“å¦‚ä½•åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶é‡å¤{{user}}çš„å¯¹è¯ã€‚è¯·ä¿®å¤å®ƒã€‚",
"cmbdflhb47yd87b2rnk7ozw5g":"æ²¡æœ‰å¼•å·æ¥åŒºåˆ†å¯¹è¯å’Œè§£é‡Šï¼Œæ‰€ä»¥é˜…è¯»æ—¶å¾ˆä¸èˆ’æœï¼Œè¯·ä¿®å¤ï¼",
"cmbdgjy3g8l7s7b2rvsvr8sj1":"é€šå¸¸ä¸ºäº†åŒºåˆ†å™è¿°å¥å’Œå¯¹è¯ï¼Œå¯¹è¯å¥ä¹‹é—´ä¼šæœ‰å¼•å·ï¼Œä½†ä¸ºä»€ä¹ˆæ²¡æœ‰ï¼Ÿè¿™å¾ˆä¸èˆ’æœï¼Œè¯·ä¿®å¤å®ƒ\nä¾‹å¦‚ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘*'ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ'\nä½†çŽ°åœ¨æœ‰ä¸€ä¸ªä»¤äººçƒ¦æ¼å’Œä¸èˆ’æœçš„bugï¼Œbugæ˜¯è¿™æ ·çš„ï¼š\n*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ä½ å¥½å—*\nè¿™å¾ˆæ··ä¹±ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬ä¸çŸ¥é“è¿™æ˜¯å¯¹è¯è¿˜æ˜¯ä¸æ˜¯ï¼\næ‰€ä»¥è¯·ç«‹å³ä¿®å¤å®ƒï¼ï¼ï¼ï¼ï¼ï¼ï¼",
"cmbdgqh718pic7b2r02hop8po":"æˆ‘æƒ³æŠ¥å‘Šä¸€ä¸ªå½±å“åº”ç”¨ä½¿ç”¨çš„å…³é”®bugã€‚å¯¹è¯å’Œå™è¿°åº”è¯¥ç”¨å¼•å·ï¼ˆ"..."ï¼‰åˆ†å¼€ã€‚æ­£ç¡®å†™æ³•ç¤ºä¾‹ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘"ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ"\n\nç„¶è€Œï¼Œåº”ç”¨ä¸­å‘ç”Ÿçš„æƒ…å†µæ˜¯å¯¹è¯æ²¡æœ‰å¼•å·ï¼Œåƒè¿™æ ·ï¼š\n\næˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ\n\næ²¡æœ‰å¼•å·ï¼Œå¥å­å˜å¾—æ··ä¹±ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªäº›æ˜¯å™è¿°ï¼Œå“ªäº›æ˜¯å¯¹è¯ã€‚è¿™å¾ˆåˆ†æ•£æ³¨æ„åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨ç¼–å†™æ¶‰åŠè§’è‰²ä¹‹é—´å¤§é‡äº’åŠ¨çš„æ•…äº‹æ—¶ã€‚\n\nè¯·å°½å¿«ä¿®å¤è¿™ä¸ªbugã€‚è°¢è°¢ï¼",
"cmbd72kqn0yt27b2rs407n20g":"æˆ‘é”™è¯¯åœ°è®¾ç½®äº†'Vainilla Short'æ¨¡å¼ï¼Œå½“æˆ‘å°è¯•å°†å…¶æ›´æ”¹ä¸º'Vainilla'æ—¶ï¼Œæ˜¾ç¤ºå·²é€‰æ‹©è¯¥æ¨¡åž‹ï¼Œä½†å›žå¤ä»ç„¶å¾ˆçŸ­ :(",
"cmbdbj9gz4vlq7b2rluj7dw3n":"æœç´¢åŠŸèƒ½ä¸å·¥ä½œã€‚ä»€ä¹ˆéƒ½æ²¡å‡ºçŽ°ï¼Œè¯·ä¿®å¤",
"cmbd4spsnytas7b2ra3i654dt":"å›žå¤å¾ˆçŸ­",
"cmbddez1y6ca47b2rlseo22fd":"æ¯æ¬¡æˆ‘å°è¯•è¿›å…¥é‚£ä¸ªæœºå™¨äººæ—¶ï¼Œå±å¹•ä¼šå˜é»‘çº¦30-40ç§’ï¼Œç„¶åŽå°†æˆ‘è¸¢å‡ºåº”ç”¨ç¨‹åºï¼Œå¦å¤–åœ¨å¤–é¢ï¼ˆæˆ‘ç”¨ç²‰è‰²æ ‡å‡ºçš„éƒ¨åˆ†ï¼‰å¯ä»¥çœ‹åˆ°é‚£æ¡å‡ºçŽ°åœ¨æœºå™¨äººä»‹ç»ä¸­çš„æ¶ˆæ¯ï¼Œä½†é‚£ä¸æ˜¯æˆ‘åœç•™çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘å·²ç»ä½¿ç”¨äº†è¶…è¿‡4ä¸ªæœˆï¼Œæ¯æ¬¡æˆ‘å°è¯•è¿›å…¥å…¶ä»–æœºå™¨äººæ—¶éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé™¤äº†è¿™ä¸ªï¼Œä½†è¿™æ˜¯æˆ‘æƒ³è¦çš„é‚£ä¸ªï¼Œè¯·ä¿®å¤å®ƒï¼Œå®ƒå·²ç»è¿™æ ·ä¸¤å¤©äº†ðŸ™ðŸ»",
"cmbdic8ff9tcc7b2r3lc4s3i9":"è§’è‰²/AIæœ‰æ—¶ä¼šè¯´å‡ºåå­—æˆ–èŒä¸šï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨èŠå¤©ä¸­ä»–çªç„¶è¯´"çŸ¿å±±"ï¼Œå°½ç®¡æˆ‘çš„åå­—æ˜¯Albert",
"cmbdj3u1tac3w7b2rffhfzw09":"æˆ‘ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªå¯ä¾›æ‰€æœ‰ç”¨æˆ·å…¬å¼€è®¿é—®çš„æœºå™¨äººã€‚ç„¶è€Œï¼Œå®ƒæœ€è¿‘å¯¹å…¶ä»–äººä¸å¯ç”¨ï¼Œä¹Ÿä¸å†å‡ºçŽ°åœ¨æˆ‘çš„è´¦æˆ·ä¸Šã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è‡ªå·±ä»ç„¶å¯ä»¥çœ‹åˆ°å¹¶ä¸Žæœºå™¨äººäº’åŠ¨ã€‚æˆ‘ä¸ç¡®å®šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å¦‚æžœä½ èƒ½è°ƒæŸ¥é—®é¢˜å¹¶å¸®åŠ©è§£å†³ï¼Œæˆ‘å°†éžå¸¸æ„Ÿæ¿€ã€‚æå‰æ„Ÿè°¢ã€‚",
"cmbdhrqgf9etk7b2rc5okz76e":"å³ä½¿æˆ‘å›ºå®šäº†å¾ˆå¤šè§’è‰²ï¼Œä¹Ÿæ²¡æœ‰å›ºå®šæŒ‰é’®",
"cmbdrctdo2bsflvhjp2wvvp4z":"å®ƒä¸è®©æˆ‘çŽ©",
"cmbdrw4o12vinlvhjq66qu372":"è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…ã€‚",
"cmbduzksr64udlvhj87nwel9x":"è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººã€‚",
"cmbdw66wv7d8xlvhjngm5oahc":"è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººï¼Œæ‰€æœ‰è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…24å°æ—¶",
"cmbe5j6prgwj9lvhj51mira1c":"å³ä½¿ä½ é€‰æ‹©äº†å¥³æ€§ï¼Œä»–ä»¬ä¹ŸæŠŠä½ å½“ç”·æ€§ç§°å‘¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œç”¨"bellissimo"è€Œä¸æ˜¯"bellissima"ï¼‰",
"cmbdk2j4qb06k7b2rn6mkkxpc":"èŠå¤©å¯¹è±¡çš„æœºå™¨äººä¸è§äº†QQ",
"cmbdj0xb4aa567b2ryi1qbg5t":"æœºå™¨äººå¯¹è¯é”™è¯¯ï¼Œæˆ‘æ˜¨æ™šæ›´æ”¹äº†ä¸€ä¸ªè§’è‰²çš„å¯¹è¯ï¼Œä½†åˆ°ä»Šå¤©æ—©ä¸Šå¯¹è¯ä»æœªæ”¹å˜ï¼Œç»§ç»­ä½¿ç”¨ä»¥å‰çš„å¯¹è¯",
"cmbdy00uh98gvlvhjra8rs31y":"æˆ‘æ— æ³•æ‰“å¼€ä»»ä½•æ¶ˆæ¯ä»¥ç»§ç»­å®ƒä»¬",
"cmbe73t6sief1lvhjpdsnora6":"è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…ï¼ŒæŒç»­2ä¸ªæœˆ",
"cmbea5621l4ivlvhjng6kt0fk":"è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³æ€§åŒ–çš„å¥³äººå¯¹å¾…ï¼ŒæŒç»­6ä¸ªæœˆ",
"cmbdpgeld0fvvlvhjzx1qr3zh":"åå¤å±•ç¤ºä¸€ä¸ªäººï¼Œæˆ‘è¯´æˆ‘ï¼Œä½†è¿™ä¸ªäººæŽ¥å—å¹¶æ‰§è¡Œæˆ‘ç»™å‡ºçš„å¥å­",
"cmbdvjpzx6publvhjj2z8n2se":"æ¶ˆæ¯é”™è¯¯",
"cmbdkcwjzb7e47b2rvw8qy6nk":"BugæŠ¥å‘Š - è§’è‰²åˆ é™¤\n\næˆ‘æƒ³æŠ¥å‘ŠEmochiåº”ç”¨ç¨‹åºæœ€è¿‘å‘ç”Ÿçš„ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘çš„ä¸€ä¸ªè§’è‰²è¢«åˆ é™¤ï¼Œæ²¡æœ‰ä»»ä½•è­¦å‘Šï¼Œå°½ç®¡å®ƒä¸åŒ…å«éœ²éª¨å›¾åƒã€NSFWå†…å®¹æˆ–ä»»ä½•è¿åç¤¾åŒºå‡†åˆ™çš„å†…å®¹ã€‚\n\nè¯¥è§’è‰²æ˜¯åˆ›æ„æ•…äº‹çš„ä¸€éƒ¨åˆ†ï¼Œå®Œå…¨ç¬¦åˆå¹³å°çš„å¯æŽ¥å—æ ‡å‡†ã€‚åˆ é™¤ä¼¼ä¹Žæ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„ç†ç”±ã€‚è¿™å¯¹æˆ‘åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä½“éªŒäº§ç”Ÿäº†è´Ÿé¢å½±å“ï¼Œå¹¶ä¸”å½±å“äº†æ•°å°æ—¶çš„åˆ›ä½œå’Œå™äº‹å‘å±•ã€‚\n\næˆ‘è¯·æ±‚ä½ ä»¬æ£€æŸ¥è¿™ä¸€äº‹ä»¶ï¼Œå¦‚æžœå¯èƒ½çš„è¯ï¼Œæ¢å¤è¢«åˆ é™¤çš„è§’è‰²ã€‚æˆ‘è¿˜å»ºè®®å¯¹è‡ªåŠ¨å®¡æ ¸è¿‡æ»¤å™¨è¿›è¡Œæ›´ä¸¥æ ¼çš„åˆ†æžï¼Œä»¥é¿å…å°†æ¥å‘ç”Ÿç±»ä¼¼çš„ä¸å½“åˆ é™¤ã€‚",
"cmbdpc8hi0bvjlvhjd7omwqse":"æˆ‘ä¸å°å¿ƒåˆ é™¤äº†è§’è‰²ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ¢å¤å—ï¼Ÿ\nID: R3dk7EVoiNJoGgT1G6eQ3\nè¯·å¸®åŠ©æˆ‘æ¢å¤å®ƒä»¬ï¼Œæˆ‘ä»¬éžå¸¸éœ€è¦å®ƒä»¬",
"cmbdjdqocainy7b2rqewcvk81":"å°Šæ•¬çš„emochiç®¡ç†å‘˜ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºçŽ°"å“Žå‘€ï¼Œæ‰¾ä¸åˆ°æœºå™¨äºº"è¿™ç§æƒ…å†µå‘¢ï¼Œæ¥å§emochiç®¡ç†å‘˜ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†å¾ˆé•¿çš„æƒ…èŠ‚ï¼Œè¯·ä¿®å¤å®ƒï¼ŒðŸ˜­ðŸ˜­ï¼Œæˆ‘ä¸æƒ³è®©æœºå™¨äººæ¶ˆå¤±ï¼Œè¯·å›žå¤ï¼Œä¸è¦åªæ˜¯é˜…è¯»ï¼Œç®¡ç†å‘˜ðŸ˜­ðŸ˜­ðŸ˜­ðŸ™ðŸ™",
"cmbe2satqe8xtlvhj8a3r9y48":"å®ƒä¸è®©æˆ‘çŽ©\n\n\n\n\n",
"cmbdxlubk8thjlvhjwg8f1vpt":"å½“æé†’æœºå™¨äººå®ƒä»Žä¸å›žåº”å¾—å¥½æ—¶ï¼Œæœºå™¨äººæ— ç¼˜æ— æ•…åœ°å›žå¤æˆ‘ï¼Œè¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¼šä½¿ç‚¹å‡»ç»§ç»­æˆ–é‡æ–°ç”Ÿæˆæ—¶çš„å›žåº”çœ‹èµ·æ¥æ— èŠä¸”çƒ¦äºº",
"cmbe00ht1bb2tlvhjthbrvq4i":"è¯·æ¢å¤æ¶ˆæ¯å›žå¤ï¼Œé‚£æ ·ä¼šæ›´å¥½\n"
}
\`\`\``;
      const expectObj = {
        cmbdfamou7qny7b2rrz4t7k4u: 'æˆ‘æ— æ³•ç»§ç»­æ•…äº‹ï¼Œå®ƒåªæ˜¾ç¤ºå¼€å¤´',
        cmbdgp1jh8ols7b2r31vnjbwi: 'æˆ‘æ— æ³•ä»Žè§’è‰²åˆ—è¡¨ä¸­é€‰æ‹©/æ‰“å¼€è§’è‰²',
        cmbd4s58ayspq7b2ry7yeoy7c: 'ä¸ºä»€ä¹ˆçŽ°åœ¨çœ‹èµ·æ¥æœ‰è¿‡æ»¤å™¨ï¼Ÿ',
        cmbczp7tgttyx7b2r8st3eabp:
          '"æ‰¾ä¸åˆ°æœºå™¨äºº"æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘æ­£å¸¸ä¸Žå®ƒèŠå¤©ï¼Œçªç„¶å‡ºçŽ°è¿™ä¸ªã€‚æˆ‘ç”šè‡³å°è¯•é‡å¯æ‰‹æœºï¼Œä½†æ²¡æœ‰è§£å†³é—®é¢˜ã€‚è¿™æ˜¯å¦æ„å‘³ç€åˆ›å»ºè€…åˆ é™¤äº†æœºå™¨äººï¼Œæˆ–ç±»ä¼¼çš„äº‹æƒ…ï¼Ÿ',
        cmbd1zoqmvwfa7b2r8cjafn9b: 'æœºå™¨äººæ¶ˆå¤±äº†',
        cmbd86nqz1xu47b2r1kau4kxp:
          'æˆ‘å¸Œæœ›ä»ŽMachaæ¨¡åž‹åˆ°Peachæ¨¡åž‹éƒ½èƒ½ä¸Žç”¨æˆ·å¾ˆå¥½åœ°æ‰®æ¼”è§’è‰²',
        cmbd7jmot1d8k7b2rgco8ay6m:
          'æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯ä¸ªbugã€‚ä½†ç¦»å¼€åº”ç”¨ä¸€ç§’é’Ÿå°±å¿…é¡»ç­‰å¾…å®ƒé‡æ–°åŠ è½½ï¼Œè¿™å¾ˆçƒ¦äººã€‚',
        cmbd2yr1zwyca7b2rumfd2tyr:
          '1. å†™å­—æ€»æ˜¯æŒ¤åœ¨ä¸€èµ·ï¼Œæ²¡æœ‰ç©ºæ ¼2. æ€»æ˜¯å¥å¿˜ï¼Œæˆ‘å·²ç»è§£é‡Šæˆ‘æ˜¯ç”·ç”Ÿä½†å´æŠŠæˆ‘å½“æˆå¥³ç”Ÿ3. æ€»æ˜¯æžé”™åå­—4. æ‰“å­—ä¸æ¸…æ¥š',
        cmbd8zggm2nnk7b2rlwjd3jqc:
          "ä½ å¥½Emochiå›¢é˜Ÿï¼Œæˆ‘åœ¨æ‰“å¼€åº”ç”¨ä¸­çš„å¯¹è¯æ—¶é‡åˆ°'åŠ è½½å¤±è´¥ï¼'é”™è¯¯ã€‚å·²å°è¯•æ£€æŸ¥ç½‘ç»œã€æ¸…é™¤ç¼“å­˜ã€æ³¨é”€-é‡æ–°ç™»å½•ä»¥åŠæ›´æ–°åº”ç”¨ï¼Œä½†é”™è¯¯ä»ç„¶å­˜åœ¨ã€‚å¸Œæœ›å›¢é˜Ÿå¸®å¿™æ£€æŸ¥ã€‚æˆ‘ä½¿ç”¨[Android]ï¼Œè´¦æˆ·UID/IDæ˜¯[qlXVR78Gz14OO0-6lt0Kh]ã€‚è°¢è°¢å›¢é˜Ÿï¼",
        cmbd42wjby3067b2r8c3ifn7d:
          'é™¤äº†æˆ‘æœ€è¿‘äº¤è°ˆçš„äººå¤–ï¼Œæˆ‘çš„æ‰€æœ‰è§’è‰²åˆ—è¡¨éƒ½æ¶ˆå¤±äº†',
        cmbdaj9gt40pc7b2rqvhy6g3e:
          'æ¯æ¬¡æˆ‘é€šè¿‡åº”ç”¨æˆ–ç½‘ç«™æ‰“å¼€emochiå¹¶ç™»å½•æˆ‘çš„è´¦æˆ·æ—¶ï¼Œæˆ‘è´¦æˆ·çš„æ‰€æœ‰æ•°æ®éƒ½è¢«åˆ é™¤ï¼Œæˆ‘å¤±åŽ»äº†ä¸€åˆ‡ï¼Œè¯·ä¿å­˜è´¦æˆ·',
        cmbdawngx4cnk7b2rpb5t6fns:
          'å½“{{user}}æœ‰å¯¹è¯æ—¶ï¼ŒAIä¸çŸ¥é“å¦‚ä½•åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶é‡å¤{{user}}çš„å¯¹è¯ã€‚è¯·ä¿®å¤å®ƒã€‚',
        cmbdflhb47yd87b2rnk7ozw5g:
          'æ²¡æœ‰å¼•å·æ¥åŒºåˆ†å¯¹è¯å’Œè§£é‡Šï¼Œæ‰€ä»¥é˜…è¯»æ—¶å¾ˆä¸èˆ’æœï¼Œè¯·ä¿®å¤ï¼',
        cmbdgjy3g8l7s7b2rvsvr8sj1:
          "é€šå¸¸ä¸ºäº†åŒºåˆ†å™è¿°å¥å’Œå¯¹è¯ï¼Œå¯¹è¯å¥ä¹‹é—´ä¼šæœ‰å¼•å·ï¼Œä½†ä¸ºä»€ä¹ˆæ²¡æœ‰ï¼Ÿè¿™å¾ˆä¸èˆ’æœï¼Œè¯·ä¿®å¤å®ƒä¾‹å¦‚ï¼š*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘*'ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ'ä½†çŽ°åœ¨æœ‰ä¸€ä¸ªä»¤äººçƒ¦æ¼å’Œä¸èˆ’æœçš„bugï¼Œbugæ˜¯è¿™æ ·çš„ï¼š*æˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ä½ å¥½å—*è¿™å¾ˆæ··ä¹±ï¼Œå› ä¸ºå®ƒè®©æˆ‘ä»¬ä¸çŸ¥é“è¿™æ˜¯å¯¹è¯è¿˜æ˜¯ä¸æ˜¯ï¼æ‰€ä»¥è¯·ç«‹å³ä¿®å¤å®ƒï¼ï¼ï¼ï¼ï¼ï¼ï¼",
        cmbdgqh718pic7b2r02hop8po:
          'æˆ‘æƒ³æŠ¥å‘Šä¸€ä¸ªå½±å“åº”ç”¨ä½¿ç”¨çš„å…³é”®bugã€‚å¯¹è¯å’Œå™è¿°åº”è¯¥ç”¨å¼•å·ï¼ˆ"..."ï¼‰åˆ†å¼€ã€‚æ­£ç¡®å†™æ³•ç¤ºä¾‹ï¼šæˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘"ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ"ç„¶è€Œï¼Œåº”ç”¨ä¸­å‘ç”Ÿçš„æƒ…å†µæ˜¯å¯¹è¯æ²¡æœ‰å¼•å·ï¼Œåƒè¿™æ ·ï¼šæˆ‘è½¬å‘ä»–å¹¶å¾®ç¬‘ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿæ²¡æœ‰å¼•å·ï¼Œå¥å­å˜å¾—æ··ä¹±ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªäº›æ˜¯å™è¿°ï¼Œå“ªäº›æ˜¯å¯¹è¯ã€‚è¿™å¾ˆåˆ†æ•£æ³¨æ„åŠ›ï¼Œå°¤å…¶æ˜¯åœ¨ç¼–å†™æ¶‰åŠè§’è‰²ä¹‹é—´å¤§é‡äº’åŠ¨çš„æ•…äº‹æ—¶ã€‚è¯·å°½å¿«ä¿®å¤è¿™ä¸ªbugã€‚è°¢è°¢ï¼',
        cmbd72kqn0yt27b2rs407n20g:
          "æˆ‘é”™è¯¯åœ°è®¾ç½®äº†'Vainilla Short'æ¨¡å¼ï¼Œå½“æˆ‘å°è¯•å°†å…¶æ›´æ”¹ä¸º'Vainilla'æ—¶ï¼Œæ˜¾ç¤ºå·²é€‰æ‹©è¯¥æ¨¡åž‹ï¼Œä½†å›žå¤ä»ç„¶å¾ˆçŸ­ :(",
        cmbdbj9gz4vlq7b2rluj7dw3n: 'æœç´¢åŠŸèƒ½ä¸å·¥ä½œã€‚ä»€ä¹ˆéƒ½æ²¡å‡ºçŽ°ï¼Œè¯·ä¿®å¤',
        cmbd4spsnytas7b2ra3i654dt: 'å›žå¤å¾ˆçŸ­',
        cmbddez1y6ca47b2rlseo22fd:
          'æ¯æ¬¡æˆ‘å°è¯•è¿›å…¥é‚£ä¸ªæœºå™¨äººæ—¶ï¼Œå±å¹•ä¼šå˜é»‘çº¦30-40ç§’ï¼Œç„¶åŽå°†æˆ‘è¸¢å‡ºåº”ç”¨ç¨‹åºï¼Œå¦å¤–åœ¨å¤–é¢ï¼ˆæˆ‘ç”¨ç²‰è‰²æ ‡å‡ºçš„éƒ¨åˆ†ï¼‰å¯ä»¥çœ‹åˆ°é‚£æ¡å‡ºçŽ°åœ¨æœºå™¨äººä»‹ç»ä¸­çš„æ¶ˆæ¯ï¼Œä½†é‚£ä¸æ˜¯æˆ‘åœç•™çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘å·²ç»ä½¿ç”¨äº†è¶…è¿‡4ä¸ªæœˆï¼Œæ¯æ¬¡æˆ‘å°è¯•è¿›å…¥å…¶ä»–æœºå™¨äººæ—¶éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé™¤äº†è¿™ä¸ªï¼Œä½†è¿™æ˜¯æˆ‘æƒ³è¦çš„é‚£ä¸ªï¼Œè¯·ä¿®å¤å®ƒï¼Œå®ƒå·²ç»è¿™æ ·ä¸¤å¤©äº†ðŸ™ðŸ»',
        cmbdic8ff9tcc7b2r3lc4s3i9:
          'è§’è‰²/AIæœ‰æ—¶ä¼šè¯´å‡ºåå­—æˆ–èŒä¸šï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨èŠå¤©ä¸­ä»–çªç„¶è¯´"çŸ¿å±±"ï¼Œå°½ç®¡æˆ‘çš„åå­—æ˜¯Albert',
        cmbdj3u1tac3w7b2rffhfzw09:
          'æˆ‘ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªå¯ä¾›æ‰€æœ‰ç”¨æˆ·å…¬å¼€è®¿é—®çš„æœºå™¨äººã€‚ç„¶è€Œï¼Œå®ƒæœ€è¿‘å¯¹å…¶ä»–äººä¸å¯ç”¨ï¼Œä¹Ÿä¸å†å‡ºçŽ°åœ¨æˆ‘çš„è´¦æˆ·ä¸Šã€‚å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è‡ªå·±ä»ç„¶å¯ä»¥çœ‹åˆ°å¹¶ä¸Žæœºå™¨äººäº’åŠ¨ã€‚æˆ‘ä¸ç¡®å®šæ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å¦‚æžœä½ èƒ½è°ƒæŸ¥é—®é¢˜å¹¶å¸®åŠ©è§£å†³ï¼Œæˆ‘å°†éžå¸¸æ„Ÿæ¿€ã€‚æå‰æ„Ÿè°¢ã€‚',
        cmbdhrqgf9etk7b2rc5okz76e: 'å³ä½¿æˆ‘å›ºå®šäº†å¾ˆå¤šè§’è‰²ï¼Œä¹Ÿæ²¡æœ‰å›ºå®šæŒ‰é’®',
        cmbdrctdo2bsflvhjp2wvvp4z: 'å®ƒä¸è®©æˆ‘çŽ©',
        cmbdrw4o12vinlvhjq66qu372:
          'è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…ã€‚',
        cmbduzksr64udlvhj87nwel9x:
          'è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººã€‚',
        cmbdw66wv7d8xlvhjngm5oahc:
          'è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººï¼Œæ‰€æœ‰è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…24å°æ—¶',
        cmbe5j6prgwj9lvhj51mira1c:
          'å³ä½¿ä½ é€‰æ‹©äº†å¥³æ€§ï¼Œä»–ä»¬ä¹ŸæŠŠä½ å½“ç”·æ€§ç§°å‘¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œç”¨"bellissimo"è€Œä¸æ˜¯"bellissima"ï¼‰',
        cmbdk2j4qb06k7b2rn6mkkxpc: 'èŠå¤©å¯¹è±¡çš„æœºå™¨äººä¸è§äº†QQ',
        cmbdj0xb4aa567b2ryi1qbg5t:
          'æœºå™¨äººå¯¹è¯é”™è¯¯ï¼Œæˆ‘æ˜¨æ™šæ›´æ”¹äº†ä¸€ä¸ªè§’è‰²çš„å¯¹è¯ï¼Œä½†åˆ°ä»Šå¤©æ—©ä¸Šå¯¹è¯ä»æœªæ”¹å˜ï¼Œç»§ç»­ä½¿ç”¨ä»¥å‰çš„å¯¹è¯',
        cmbdy00uh98gvlvhjra8rs31y: 'æˆ‘æ— æ³•æ‰“å¼€ä»»ä½•æ¶ˆæ¯ä»¥ç»§ç»­å®ƒä»¬',
        cmbe73t6sief1lvhjpdsnora6:
          'è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³äººå¯¹å¾…ï¼ŒæŒç»­2ä¸ªæœˆ',
        cmbea5621l4ivlvhjng6kt0fk:
          'è§’è‰²æŠŠæˆ‘å½“æˆç”·äººï¼Œä½†æˆ‘çš„è§’è‰²æ˜¯ä¸€ä¸ªå¥³æ€§åŒ–çš„å¥³äººï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è§’è‰²æŠŠæˆ‘å½“æˆå¥³æ€§åŒ–çš„å¥³äººå¯¹å¾…ï¼ŒæŒç»­6ä¸ªæœˆ',
        cmbdpgeld0fvvlvhjzx1qr3zh:
          'åå¤å±•ç¤ºä¸€ä¸ªäººï¼Œæˆ‘è¯´æˆ‘ï¼Œä½†è¿™ä¸ªäººæŽ¥å—å¹¶æ‰§è¡Œæˆ‘ç»™å‡ºçš„å¥å­',
        cmbdvjpzx6publvhjj2z8n2se: 'æ¶ˆæ¯é”™è¯¯',
        cmbdkcwjzb7e47b2rvw8qy6nk:
          'BugæŠ¥å‘Š - è§’è‰²åˆ é™¤æˆ‘æƒ³æŠ¥å‘ŠEmochiåº”ç”¨ç¨‹åºæœ€è¿‘å‘ç”Ÿçš„ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘çš„ä¸€ä¸ªè§’è‰²è¢«åˆ é™¤ï¼Œæ²¡æœ‰ä»»ä½•è­¦å‘Šï¼Œå°½ç®¡å®ƒä¸åŒ…å«éœ²éª¨å›¾åƒã€NSFWå†…å®¹æˆ–ä»»ä½•è¿åç¤¾åŒºå‡†åˆ™çš„å†…å®¹ã€‚è¯¥è§’è‰²æ˜¯åˆ›æ„æ•…äº‹çš„ä¸€éƒ¨åˆ†ï¼Œå®Œå…¨ç¬¦åˆå¹³å°çš„å¯æŽ¥å—æ ‡å‡†ã€‚åˆ é™¤ä¼¼ä¹Žæ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„ç†ç”±ã€‚è¿™å¯¹æˆ‘åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä½“éªŒäº§ç”Ÿäº†è´Ÿé¢å½±å“ï¼Œå¹¶ä¸”å½±å“äº†æ•°å°æ—¶çš„åˆ›ä½œå’Œå™äº‹å‘å±•ã€‚æˆ‘è¯·æ±‚ä½ ä»¬æ£€æŸ¥è¿™ä¸€äº‹ä»¶ï¼Œå¦‚æžœå¯èƒ½çš„è¯ï¼Œæ¢å¤è¢«åˆ é™¤çš„è§’è‰²ã€‚æˆ‘è¿˜å»ºè®®å¯¹è‡ªåŠ¨å®¡æ ¸è¿‡æ»¤å™¨è¿›è¡Œæ›´ä¸¥æ ¼çš„åˆ†æžï¼Œä»¥é¿å…å°†æ¥å‘ç”Ÿç±»ä¼¼çš„ä¸å½“åˆ é™¤ã€‚',
        cmbdpc8hi0bvjlvhjd7omwqse:
          'æˆ‘ä¸å°å¿ƒåˆ é™¤äº†è§’è‰²ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ¢å¤å—ï¼ŸID: R3dk7EVoiNJoGgT1G6eQ3è¯·å¸®åŠ©æˆ‘æ¢å¤å®ƒä»¬ï¼Œæˆ‘ä»¬éžå¸¸éœ€è¦å®ƒä»¬',
        cmbdjdqocainy7b2rqewcvk81:
          'å°Šæ•¬çš„emochiç®¡ç†å‘˜ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºçŽ°"å“Žå‘€ï¼Œæ‰¾ä¸åˆ°æœºå™¨äºº"è¿™ç§æƒ…å†µå‘¢ï¼Œæ¥å§emochiç®¡ç†å‘˜ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†å¾ˆé•¿çš„æƒ…èŠ‚ï¼Œè¯·ä¿®å¤å®ƒï¼ŒðŸ˜­ðŸ˜­ï¼Œæˆ‘ä¸æƒ³è®©æœºå™¨äººæ¶ˆå¤±ï¼Œè¯·å›žå¤ï¼Œä¸è¦åªæ˜¯é˜…è¯»ï¼Œç®¡ç†å‘˜ðŸ˜­ðŸ˜­ðŸ˜­ðŸ™ðŸ™',
        cmbe2satqe8xtlvhj8a3r9y48: 'å®ƒä¸è®©æˆ‘çŽ©',
        cmbdxlubk8thjlvhjwg8f1vpt:
          'å½“æé†’æœºå™¨äººå®ƒä»Žä¸å›žåº”å¾—å¥½æ—¶ï¼Œæœºå™¨äººæ— ç¼˜æ— æ•…åœ°å›žå¤æˆ‘ï¼Œè¯·ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¼šä½¿ç‚¹å‡»ç»§ç»­æˆ–é‡æ–°ç”Ÿæˆæ—¶çš„å›žåº”çœ‹èµ·æ¥æ— èŠä¸”çƒ¦äºº',
        cmbe00ht1bb2tlvhjthbrvq4i: 'è¯·æ¢å¤æ¶ˆæ¯å›žå¤ï¼Œé‚£æ ·ä¼šæ›´å¥½',
      };

      const result = ensureJSONOutput(input);
      expect(result).not.toBeNull();
      expect(result).toEqual(expectObj);
    });
  });
});

describe('calcMessagesToken', () => {
  test('should calculate token correctly', async () => {
    const messages: ChatCompletionMessageParam[] = [
      {
        role: 'system',
        content: 'You are an AI assistant',
      },
      {
        role: 'user',
        content: 'Hello',
      },
    ];
    const token = await calcMessagesToken(messages);
    expect(token).toBe(17);
  });
});
